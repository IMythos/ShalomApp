<div class="w-full min-h-screen bg-gray-100 p-6">

  <!-- Título principal -->
  <h2 class="text-3xl font-extrabold text-gray-900 mb-8 tracking-tight">
    Gestión de Usuarios
  </h2>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- FORM CARD -->
    <div class="bg-white p-6 rounded-3xl shadow-lg border border-gray-200">

      <h3 class="text-xl font-bold mb-6 text-red-700">
        @if (editMode() === 'create') {
        Crear usuario
        } @else {
        Editar usuario
        }
      </h3>

      <form [formGroup]="userForm" (ngSubmit)="editMode() === 'create' ? createUser() : updateUser()" class="space-y-5">

        <!-- Username -->
        <div class="group">
          <label class="text-xs font-semibold text-gray-600 mb-1 block">Nombre de usuario</label>
          <input formControlName="username"
            class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
        </div>

        <!-- Nombre y apellido -->
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label class="text-xs font-semibold text-gray-600 mb-1 block">Nombre</label>
            <input formControlName="firstname"
              class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
          </div>

          <div>
            <label class="text-xs font-semibold text-gray-600 mb-1 block">Apellido</label>
            <input formControlName="lastname"
              class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
          </div>
        </div>

        <!-- Correo -->
        <div>
          <label class="text-xs font-semibold text-gray-600 mb-1 block">Correo</label>
          <input type="email" formControlName="email"
            class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
        </div>

        <!-- Password solo en CREATE -->
        @if (editMode() === 'create') {
        <div>
          <label class="text-xs font-semibold text-gray-600 mb-1 block">Contraseña</label>
          <input type="password" formControlName="password"
            class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
        </div>
        }

        <!-- Rol -->
        <div>
          <label class="text-xs font-semibold text-gray-600 mb-1 block">Rol</label>
          <select formControlName="role"
            class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
            <option [ngValue]="UserRole.CLIENT">Cliente</option>
            <option [ngValue]="UserRole.ADMIN">Administrador</option>
            <option [ngValue]="UserRole.EMPLOYEE">Empleado</option>
          </select>
        </div>

        <!-- Otros datos -->
        <div class="grid md:grid-cols-2 gap-4">

          <div>
            <label class="text-xs font-semibold text-gray-600 mb-1 block">DNI</label>
            <input formControlName="dni"
              class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
          </div>

          <div>
            <label class="text-xs font-semibold text-gray-600 mb-1 block">Teléfono</label>
            <input formControlName="phone"
              class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
          </div>

          <div class="md:col-span-2">
            <label class="text-xs font-semibold text-gray-600 mb-1 block">Dirección</label>
            <input formControlName="address"
              class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
          </div>

          <div class="md:col-span-2">
            <label class="text-xs font-semibold text-gray-600 mb-1 block">Fecha de contratación</label>
            <input type="date" formControlName="hireDate"
              class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-400 outline-none transition">
          </div>
        </div>

        <!-- Botones -->
        <button type="submit"
          class="w-full py-3 mt-2 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700 transition">
          @if (editMode() === 'create') {
          Crear
          } @else {
          Guardar cambios
          }
        </button>

        @if (editMode() === 'edit') {
        <button type="button" (click)="resetForm()"
          class="w-full py-3 rounded-xl bg-gray-300 text-gray-900 hover:bg-gray-400 transition">
          Cancelar
        </button>
        }

      </form>

    </div>

    <!-- TABLE SECTION -->
    <div class="lg:col-span-2">

      @if (error()) {
      <div class="p-4 mb-4 bg-red-100 border border-red-300 text-red-800 rounded-xl shadow">
        {{ error() }}
      </div>
      }

      @if (loading()) {
      <div class="text-center py-10 text-red-600 font-semibold">
        Cargando usuarios...
      </div>
      }

      @if (!loading() && users().length > 0) {

      <div class="bg-white rounded-3xl shadow-lg border border-gray-200 overflow-hidden">

        <table class="min-w-full text-sm text-gray-700">
          <thead class="bg-red-600 text-white text-xs uppercase sticky top-0">
            <tr>
              <th class="p-4 text-left">Usuario</th>
              <th class="p-4 text-left">Correo</th>
              <th class="p-4 text-left">Rol</th>
              <th class="p-4 text-center">Acciones</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-200">

            @for (u of users(); track u.id) {

            <tr class="hover:bg-red-50 transition">

              <td class="p-4 font-semibold text-gray-900">
                {{ u.fullname }}
              </td>

              <td class="p-4">
                {{ u.email }}
              </td>

              <td class="p-4 font-semibold text-red-700">
                {{ u.role }}
              </td>

              <td class="p-4 text-center space-x-2">

                <button (click)="startEdit(u)"
                  class="px-4 py-1.5 rounded-lg bg-red-400 text-white hover:bg-red-500 transition">
                  Editar
                </button>

                <button (click)="deleteUser(u.id!)"
                  class="px-4 py-1.5 rounded-lg bg-red-700 text-white hover:bg-red-800 transition">
                  Eliminar
                </button>

              </td>

            </tr>

            }

          </tbody>
        </table>

      </div>
      }

    </div>

  </div>

</div>
