<main class="w-full min-h-screen bg-gray-50">
  <client-header></client-header>

  <section class="w-full flex justify-center px-4 sm:px-6 lg:px-8 py-8">
    <div class="w-full max-w-7xl">
      <h2
        class="text-3xl font-extrabold text-white mb-6 rounded-lg px-4 py-2 bg-[#EE2A2F] shadow-md inline-block border-b-4 border-red-700">
        Registrar Nuevo Envío
      </h2>
      <div class="grid grid-cols-12 gap-8">
        <div
          class="col-span-12 lg:col-span-5 bg-white p-6 rounded-xl shadow-xl transition duration-500 min-h-[700px] flex flex-col">
          <h3 class="text-2xl font-semibold text-gray-700 mb-6 border-l-4 border-[#EE2A2F] pl-3">Detalles de la Solicitud</h3>
          <form [formGroup]="solicitudeForm" (ngSubmit)="onSubmit()" class="flex flex-col flex-1">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
              <div class="col-span-1 md:col-span-2">
                <h4 class="text-lg font-medium text-gray-600 border-b border-gray-200 pb-2 mb-4">1. Datos del
                  Destinatario</h4>
              </div>
              <div class="col-span-1">
                <label for="recipientDni" class="block text-sm font-medium text-gray-700 mb-1">DNI</label>
                <input id="recipientDni" formControlName="recipientDni" type="text" placeholder="Ej: 12345678"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#EE2A2F] focus:border-[#EE2A2F] transition duration-150"
                  [class.border-red-500]="isInvalid('recipientDni')">
                  @if (isInvalid('recipientDni')) {
                    <p class="text-xs text-[#EE2A2F] mt-1">DNI es obligatorio y debe contener solo números.</p>
                  }
              </div>
              <div class="col-span-1">
                <label for="recipientName" class="block text-sm font-medium text-gray-700 mb-1">Destinatario</label>
                <input id="recipientName" formControlName="recipientName" type="text" placeholder="Ej: Juan Pérez"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#EE2A2F] focus:border-[#EE2A2F] transition duration-150"
                  [class.border-red-500]="isInvalid('recipientName')">
                  @if (isInvalid('recipientName')) {
                    <p class="text-xs text-[#EE2A2F] mt-1">Nombre es obligatorio.</p>
                  }
              </div>
              <div class="col-span-1">
                <label for="recipientCity" class="block text-sm font-medium text-gray-700 mb-1">Agencia de Origen</label>
                <select id="recipientCity" formControlName="recipientCity"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#EE2A2F] focus:border-[#EE2A2F] appearance-none bg-white transition duration-150"
                  [class.border-red-500]="isInvalid('recipientCity')">
                  <option value="" disabled>
                    @if (loadingAgencies()) {
                      Cargando agencias ...
                    } @else {
                      Seleccione agencia de origen
                    }
                  </option>
                    @for (agency of availableAgencies; track agency) {
                      <option [value]="agency.name">{{ agency.name }}</option>
                    }
                </select>
                  @if (isInvalid('recipientCity')) {
                    <p class="text-xs text-[#EE2A2F] mt-1">Agencia de Origen es obligatoria.</p>
                  }
              </div>

              <div class="col-span-1">
                <label for="destinationCity" class="block text-sm font-medium text-gray-700 mb-1">Agencia deDestino</label>
                <select id="destinationCity" formControlName="destinationCity"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#EE2A2F] focus:border-[#EE2A2F] appearance-none bg-white transition duration-150"
                  [class.border-red-500]="isInvalid('destinationCity')">
                  <option value="" disabled>
                    @if (loadingAgencies()) {
                      Cargando agencias ...
                    } @else {
                      Seleccione agencia de destino
                    }
                  </option>
                    @for (agency of availableAgencies; track agency) {
                      <option [value]="agency.name">{{ agency.name }}</option>
                    }
                </select>
                  @if (isInvalid('destinationCity')) {
                    <p class="text-xs text-[#EE2A2F] mt-1">Ciudad de Destino es obligatoria.</p>
                  }
              </div>
              <div class="col-span-1 md:col-span-2">
                <h4 class="text-lg font-medium text-gray-600 border-b border-gray-200 pb-2 mb-4 mt-4">2. Detalles del Paquete</h4>
              </div>
              <div class="col-span-1 md:col-span-2">
                <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Descripción del Contenido</label>
                <textarea id="description" formControlName="description" rows="3"
                  placeholder="Detalle breve y conciso del contenido del paquete."
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#EE2A2F] focus:border-[#EE2A2F] transition duration-150 resize-none"
                  [class.border-red-500]="isInvalid('description')"></textarea>
                @if (isInvalid('description')) {
                  <p class="text-xs text-[#EE2A2F] mt-1">Descripción es obligatoria.</p>
                }
              </div>
              <div class="col-span-1 md:col-span-2">
                <label for="packageImage" class="block text-sm font-medium text-gray-700 mb-1">Imagen del Paquete (Requerido)</label>
                <input id="packageImage" type="file" (change)="onFileSelected($event)" accept="image/*"
                  class="w-full block text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-[#EE2A2F] hover:file:bg-red-100 cursor-pointer">
                @if (packageImageError() !== '') {
                  <p class="text-xs text-red-600 mt-1">{{ packageImageError() }}</p>
                }
                @if (packageImageFile() && packageImageError() === '') {
                  <p class="text-xs text-green-600 mt-1 flex items-center">
                    <svg class="w-3 h-3 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
                      stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                      <path d="m9 11 3 3L22 4" />
                    </svg>
                    Archivo seleccionado: {{ packageImageFile()?.name }}
                  </p>
                }
              </div>
            </div>

            <div class="mt-6">
              @if (loading()) {
                <p class="text-[#EE2A2F] flex items-center">Enviando solicitud...</p>
              } @else if (successMessage()) {
                  <p class="text-green-600 font-semibold">{{ successMessage() }}</p>
              } @else if (errorMessage()) {
                  <p class="text-red-600 font-semibold">{{ errorMessage() }}</p>
              }
            </div>
            <div class="mt-6 flex justify-end">
              <button type="submit" [disabled]="solicitudeForm.invalid || !packageImageFile() || loading()"
                class="px-6 py-3 bg-[#EE2A2F] text-white font-bold rounded-lg shadow-lg hover:bg-[#D5262B] transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                Registrar Solicitud
              </button>
            </div>
          </form>
        </div>
        <div class="col-span-12 lg:col-span-7 bg-linear-to-tr from-[#ff979b] to-white rounded-xl hidden lg:flex items-center justify-center">
          <img src="assets/images/box-open.png" alt="Paquete" class="max-w-full max-h-full object-contain">
        </div>
        <div class="col-span-12 mt-8 bg-white shadow-xl rounded-xl">
          <div class="p-4 sm:p-6 lg:p-8">
            <h2
              class="text-2xl font-extrabold text-white mb-4 rounded-lg px-4 py-2 bg-[#EE2A2F] shadow-md inline-block border-b-4 border-red-700">
              Mis Solicitudes
            </h2>
            @if (solicitudeList().length === 0) {
            <p class="text-gray-500">No hay solicitudes registradas aún.</p>
            } @else {
            <div class="overflow-x-auto">
              <table class="min-w-full bg-white border border-gray-200 rounded-xl shadow-md">
                <thead class="bg-[#444444]">
                  <tr>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">ID</th>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">Destinatario</th>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">Ciudad Origen</th>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">Ciudad Destino</th>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">Descripción</th>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">Fecha</th>
                    <th class="py-3 px-4 text-left text-sm font-semibold text-white border-b">Estado</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                  @for (solicitude of solicitudeList(); track solicitude.id) {
                  <tr class="hover:bg-red-50 transition duration-150">
                    <td class="py-2 px-4 text-sm text-gray-700">{{ solicitude.id }}</td>
                    <td class="py-2 px-4 text-sm text-gray-700">{{ solicitude.recipientName }}</td>
                    <td class="py-2 px-4 text-sm text-gray-700">{{ solicitude.recipientCity }}</td>
                    <td class="py-2 px-4 text-sm text-gray-700">{{ solicitude.destinationCity }}</td>
                    <td class="py-2 px-4 text-sm text-gray-700">{{ solicitude.description }}</td>
                    <td class="py-2 px-4 text-sm text-gray-700">{{ solicitude.requestDate }}</td>
                    <td class="py-2 px-4 text-sm text-gray-700">
                      @if (solicitude.status === 'Pending') {
                      <span class="px-2 py-1 rounded-full bg-red-100 text-red-700 font-semibold text-xs">Pending</span>
                      } @else if (solicitude.status === 'Completed') {
                      <span
                        class="px-2 py-1 rounded-full bg-green-100 text-green-700 font-semibold text-xs">Completed</span>
                      } @else if (solicitude.status === 'Canceled') {
                      <span
                        class="px-2 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold text-xs">Canceled</span>
                      } @else {
                      <span class="px-2 py-1 rounded-full bg-gray-50 text-gray-500 font-semibold text-xs">{{
                        solicitude.status }}</span>
                      }
                    </td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
            }
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
