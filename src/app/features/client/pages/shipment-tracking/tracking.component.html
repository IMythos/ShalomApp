<main class="w-full">
  <client-header></client-header>
  <div class="w-full flex flex-col items-center pt-12 pb-12 px-4 sm:px-6 lg:px-8">
    <div class="w-full max-w-7xl bg-white p-6 sm:p-10">
      <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Rastreo de Envíos</h1>
      <p class="text-gray-600 mb-8 text-sm">
        Introduce el código UUID de tu envío para conocer su estado y ubicación actual.
      </p>
      <form [formGroup]="trackingForm" (ngSubmit)="onTracking()" class="flex flex-col  text-sm sm:flex-row gap-4 mb-8">
        <input type="text" formControlName="code" placeholder="Introduce tu Código de Envío (UUID)"
          class="grow px-5 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:ring-[#EE2A2F] focus:border-[#EE2A2F] text-gray-800">
        <button type="submit" [disabled]="trackingForm.invalid || isLoading()"
          class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 text-white bg-[#EE2A2F] font-semibold rounded-lg hover:bg-red-700 transition duration-300 shadow-lg disabled:bg-red-300">
          @if (isLoading()) {
            <lucide-icon [img]="RefreshCwIcon" strokeWidth="1" class="animate-spin"></lucide-icon>
            <span>Buscando...</span>
          } @else {
            <lucide-icon [img]="SearchIcon" strokeWidth="1"></lucide-icon>
            <span>Rastrear Envío</span>
          }
        </button>
      </form>
      @if (trackingForm.get('code')?.invalid && trackingForm.get('code')?.touched) {
        <p class="text-sm text-red-600 mt-2">
          El código de envío es obligatorio.
        </p>
      }
      <div class="text-sm mt-8 p-6 border-2 border-dashed rounded-xl transition-all duration-300"
        [ngClass]="{'border-green-400 bg-green-50': shipmentData(), 'border-red-400 bg-red-50': errorMessage()}">
        @if (errorMessage()) {
          <div class="flex items-center p-3 text-red-700 bg-red-200 rounded-lg" role="alert">
            <lucide-icon [img]="MailWarningIcon" strokeWidth="1"></lucide-icon>
            <span class="font-medium">{{ errorMessage() }}</span>
          </div>
        } @else if (shipmentData()) {
          <div class="flex items-center gap-2 p-3 text-green-700 bg-green-200 rounded-lg" role="alert">
            <lucide-icon [img]="CircleCheckIcon" strokeWidth="1"></lucide-icon>
            <span class="font-medium">¡Éxito! Envío encontrado.</span>
          </div>
        } @else {
          <div class="text-center text-gray-500 py-4">
            Introduce un código para iniciar la búsqueda.
          </div>
        }
        @if (shipmentData()) {
          <div class="mt-6 space-y-4">
            <div class="flex justify-between items-center border-b pb-2">
              <span class="text-gray-600 font-medium">Estado:</span>
              <span class="font-bold text-xl" [ngClass]="{
                    'text-blue-600': shipmentData()!.status === 'EN_TRANSITO',
                    'text-green-600': shipmentData()!.status === 'ENTREGADO',
                    'text-red-600': shipmentData()!.status === 'CANCELADO',
                    'text-yellow-600': shipmentData()!.status === 'PENDIENTE'
                  }">{{ shipmentData()!.status }}</span>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
              <div class="flex flex-col">
                <span class="text-sm text-gray-500">Código de Rastreo:</span>
                <span class="font-semibold text-gray-800">{{ shipmentData()!.code }}</span>
              </div>
              <div class="flex flex-col">
                <span class="text-sm text-gray-500">Fecha de Creación:</span>
                <span class="font-semibold text-gray-800">{{ shipmentData()!.date | date:'medium' }}</span>
              </div>
              <div class="flex flex-col">
                <span class="text-sm text-gray-500">Ruta (Origen - Destino):</span>
                <span class="font-semibold text-gray-800">{{ shipmentData()!.route }}</span>
              </div>
              <div class="flex flex-col">
                <span class="text-sm text-gray-500">Tipo de Servicio:</span>
                <span class="font-semibold text-gray-800">{{ shipmentData()!.service }}</span>
              </div>
              <div class="flex flex-col sm:col-span-2">
                <span class="text-sm text-gray-500">Descripción del Paquete:</span>
                <span class="font-semibold text-gray-800">{{ shipmentData()!.packageDescription }}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>

</main>
